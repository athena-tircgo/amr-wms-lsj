<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>PTS ⇄ WMS 通訊規格書</title>

<!-- Mermaid UMD -->
<script src="https://cdn.jsdelivr.net/npm/mermaid@9.4.0/dist/mermaid.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<style>
body { font-family: "Noto Sans TC", sans-serif; max-width: 960px; margin: 40px auto; line-height: 1.6; color: #222; padding: 0 24px; }
h1,h2,h3 { color:#004b8d; }
pre { background:#f5f5f5; padding:8px 12px; border-radius:6px; overflow-x:auto; }
.page-break { display:block; page-break-before:always; break-before:page; }
@media print { .page-break { page-break-before:always; break-before:page; } }
</style>
</head>
<body>
<div id="content">🚀 正在載入 README.md...</div>

<script>
const pageBreakTitles = ["0. 版本管理", "1. 總覽", "2. API 定義"]; // 指定換頁標題

fetch("README.md")
  .then(res => res.text())
  .then(mdText => {
    const container = document.getElementById("content");

    // 轉 Markdown → HTML
    container.innerHTML = marked.parse(mdText);

    // 轉換 Mermaid 區塊
    document.querySelectorAll("pre code.language-mermaid").forEach(codeBlock => {
      const div = document.createElement("div");
      div.className = "mermaid";
      div.textContent = codeBlock.textContent.trim();
      codeBlock.parentElement.replaceWith(div);
    });

    // 初始化 Mermaid
    if (window.mermaid) {
      mermaid.initialize({ startOnLoad:false });
      mermaid.init(undefined, document.querySelectorAll(".mermaid"));
    }

    // 插入換頁
    document.querySelectorAll("#content h2, #content h3").forEach(header => {
      if (pageBreakTitles.includes(header.textContent.trim())) {
        const breaker = document.createElement("div");
        breaker.className = "page-break";
        header.before(breaker);
      }
    });

  })
  .catch(err => {
    document.getElementById("content").innerHTML = "❌ 載入失敗：" + err;
  });
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>PTS ⇄ WMS 通訊規格書</title>

<!-- Mermaid UMD 版本 -->
<script src="https://cdn.jsdelivr.net/npm/mermaid@9.4.0/dist/mermaid.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<style>
body {
  font-family: "Noto Sans TC", sans-serif;
  max-width: 960px;
  margin: 40px auto;
  line-height: 1.6;
  color: #222;
  background-color: #fdfdfd;
  padding: 0 24px;
}
pre {
  background: #f5f5f5;
  padding: 8px 12px;
  border-radius: 6px;
  overflow-x: auto;
}
h1, h2, h3 { color: #004b8d; }
.page-break { display: block; page-break-before: always; break-before: page; }
@media print {
  .page-break { page-break-before: always; break-before: page; }
}
</style>
</head>
<body>
<div id="content">🚀 正在載入 README.md...</div>

<script>
const pageBreakTitles = ["0. 版本管理", "1. 總覽", "2. API 定義"]; // 指定換頁標題

fetch("README.md")
  .then(res => res.text())
  .then(mdText => {
    const container = document.getElementById("content");
    container.innerHTML = marked.parse(mdText);

    // 將 Mermaid code 區塊轉成 div
    document.querySelectorAll("pre code.language-mermaid").forEach(block => {
      const parent = block.parentElement;
      const div = document.createElement("div");
      div.className = "mermaid";
      div.textContent = block.textContent.trim();
      parent.replaceWith(div);
    });

    // 初始化 Mermaid
    if (window.mermaid) {
      mermaid.initialize({ startOnLoad: false });
      mermaid.init(undefined, document.querySelectorAll(".mermaid"));
    }

    // 指定標題換頁，注意要在 Mermaid 初始化後，避免破壞圖表
    document.querySelectorAll("#content h2, #content h3").forEach(header => {
      const title = header.textContent.trim();
      if (pageBreakTitles.includes(title)) {
        const breaker = document.createElement("div");
        breaker.className = "page-break";
        header.before(breaker);
      }
    });

  })
  .catch(err => {
    document.getElementById("content").innerHTML = "❌ 載入失敗：" + err;
  });
</script>
</body>
</html>
